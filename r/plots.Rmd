---
title: "Plots"
output:
  html_document:
    code_folding: hide
    df_print: paged
    toc: yes
    toc_collapsed: true
    toc_float: true
editor_options: 
  chunk_output_type: console
---

<style type = "text/css">h1.title { font-size: 32px;} h1 { font-size: 24px;} h2 { font-size: 20px; } h3 { font-size: 16px; }</style>

```{r include = FALSE}
## Setting global chunk options
knitr::opts_chunk$set(collapse = TRUE, warning = FALSE, message = FALSE)
```

# Workspace and Other Setup {.tabset .tabset-fade}
## Packages & Settings
```{r results = "hide"}
library(wso)
library(tidyverse)
library(lubridate)
library(scales)
library(ggrepel)
wso::util.settings()
```

## Directories and Files
```{r}
if (.Platform$OS.type == "windows") {
  baseDir <- "C:\\Desktop\\GitHub\\code-book"
} else {
  baseDir <- "~/Desktop/GitHub/code-book/r"
}

dataDir <- file.path(baseDir, "_data")
```

## Modify data
To make our data more convenient to work with
```{r}
miris <- iris %>%
  mutate_if(
    is.numeric, ~ . * 1000
  ) %>%
  mutate(
    wsoIndex = 1:nrow(iris)
  )

fuelEconomy <- mpg %>%
  group_by(year, cyl) %>%
  summarize(
    avgHwy = mean(hwy)
  )

monthlyStorms <- storms %>% 
  mutate(
    year = make_date(year)
  ) %>%
  group_by(year, name) %>% 
  summarise(
    meanPressure = mean(pressure),
    meanWind = mean(wind)
  ) %>%
  group_by(year) %>% 
  summarise(
    count = dplyr::n(),
    meanPressure = mean(meanPressure),
    meanWind = mean(meanWind)
  ) %>% 
  mutate(
    studyPeriod = if_else(
      year >= make_date(2000) & year <= make_date(2010),
      TRUE, FALSE
    )
  ) %>%
  filter(
    year >= make_date(1998) & year <= make_date(2012)
  )
```

## Themes and colors
```{r}
theme_cs <- theme_minimal() +
  theme(
    
    ## Title
    plot.title = element_text(
      size = 14, face = "bold", hjust = 0.5,
      margin = margin(t = 10, r = 0, b = 10, l = 0)
    ),
    
    ## Axis
    axis.text = element_text(size = 10),
    axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 10, l = 0)),
    axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 10)),
    
    ## Legend
    legend.title = element_text(face = "bold"),
    legend.text = element_text(size = 10)
    
  )
```

# Shapes
## Path
```{r}
economics <- economics %>%
  mutate(
    unemployRate = unemploy/pop
  )

economics %>%
  ggplot() +
    geom_path(
      mapping = aes(unemployRate, y = psavert, color = as.numeric(date)),
      lineend = "butt", linejoin = "round", linemitre = 1
    ) +
    wso::color.scale_color_wso(
      discrete = FALSE,
      palette = "dark blue to green",
      name = "Year",
      labels = function(label) {
        labelDate <- as.Date(label, origin = "1970-01-01")
        year(labelDate)
      }
    ) +
    labs(
      title = "Unemployment vs Personal Savings Over Time",
      x = "Unemployment Rate",
      y = "Personal Savings"
    ) +
    theme_cs
```

## Polygon
```{r}
ids <- factor(c("A", "B", "C", "D", "E", "F"))

values <- tibble(
  id = ids,
  value = c(3, 3.1, 3.1, 3.2, 3.15, 3.5)
)

positions <- tibble(
  id = rep(ids, each = 4),
  x = c(2, 1, 1.1, 2.2, 1, 0, 0.3, 1.1, 2.2, 1.1, 1.2, 2.5, 1.1, 0.3,
  0.5, 1.2, 2.5, 1.2, 1.3, 2.7, 1.2, 0.5, 0.6, 1.3),
  y = c(-0.5, 0, 1, 0.5, 0, 0.5, 1.5, 1, 0.5, 1, 2.1, 1.7, 1, 1.5,
  2.2, 2.1, 1.7, 2.1, 3.2, 2.8, 2.1, 2.2, 3.3, 3.2)
)

datapoly <- left_join(values, positions, by = "id")

datapoly %>%
  ggplot() +
    geom_polygon(
      aes( x = x, y = y, fill = value, group = id)
    ) + 
    wso::color.scale_fill_wso(
      discrete = FALSE,
      palette = "blue green red",
      name = "Score"
    ) +
    labs(
      title = "No Clue What This Is",
      x = "A crazy variable",
      y = "Something wild"
    ) +
    theme_cs
```

## Rectangle (e.g. Background coloring)
### Horizontal (Data outside ggplot)
Note that here we are defining our data outside of our main geom so that we can properly apply an alpha.
Details here :https://stackoverflow.com/questions/17521438/geom-rect-and-alpha-does-this-work-with-hard-coded-values

Also note that with dates in the x-axis, we need to keep `xmin` and `xmax` out of `aes()` because it would try to coerce `Inf` as a date, which will not work. Alternatively, we could have specified `min(monthlyStorms$date)` and `max(monthlyStorms$date)` in our dataframe and kept `xmin` and `xmax` in our `aes()`, but then the colored background doesn't extend to the edge of the plot, it only goes to the middle of the first and last bar, which isn't the greatest looking thing in the world.
```{r}
ggplot() +
  geom_rect(
    aes(ymin = -Inf, ymax = 8000), 
    xmin = -Inf, xmax = Inf, 
    alpha = 0.25, fill = wso::color.wsoCols("green")
  ) +
  geom_line(
    data = economics,
    aes(x = date, y = unemploy),
    color = wso::color.wsoCols("dark blue"), size = 0.75
  ) +
  scale_y_continuous(
    label = comma_format(1)
  ) +
  labs(
    title = "US Unemployment",
    x = "Date",
    y = "People Out of Work"
  ) +
  theme_cs
```

### Horizontal (Data insde ggplot)
To avoid having to specify your data in every layer, one work around is to provide a single row from the data set in your rectangle. This will prevent the rectangle from appearing once for each time in your dataset (which prevents you from being able to use alpha).
```{r}
economics %>%
  ggplot() +
    geom_rect(
      data = economics[1,],
      aes(xmin = min(economics$date), xmax = max(economics$date), ymin = 8000, ymax = Inf), 
      alpha = 0.25, fill = wso::color.wsoCols("red")
    ) +
    geom_line(
      aes(x = date, y = unemploy),
      color = wso::color.wsoCols("dark blue"), size = 0.75
    ) +
    scale_y_continuous(
      label = comma_format(1)
    ) +
    labs(
      title = "US Unemployment",
      x = "Date",
      y = "People Out of Work"
    ) +
    theme_cs
```

## Horizontal (with data frame)
```{r}
## No x min or max here because we want to use Inf, and can't make that jive with our date axis
## We'll specify them outside of aes in our geom_rect
backgrounds <- tibble(
  minY = c(0, 15),
  maxY = c(15, Inf),
  fillColor = c("Average", "Abnormal")
)

monthlyStorms %>%
  ggplot() +
    geom_rect(
      data = backgrounds, 
      aes(ymin = minY, ymax = maxY, fill = fillColor), 
      xmin = -Inf, xmax = Inf,
      alpha = .2
    ) +
    geom_col(
      aes(x = year, y = count), fill = unname(wso::color.wsoCols("dark blue"))
    ) +
    scale_fill_manual(
      name = "Frequency",
      aesthetics = c("fill"),
      values = c(
        "Average" = unname(wso::color.wsoCols("green")),
        "Abnormal" = unname(wso::color.wsoCols("red"))
      )
    ) +
    labs(
      title = "Storms in US Per Year",
      x = "Year",
      y = "Count of storms"
    ) +
    theme_cs
```

## Vertical (by value)
Here we use `dplyr::lead(date)` to dynamically set our `xmax`... basically this grabs the next value in line.
```{r}
economicsAdj <- economics %>%
  mutate(
    status = if_else(
      unemploy > 8000,
      "Recession", "Boon"
    )
  ) 

economicsAdj %>%
  ggplot() +
    geom_rect(
      aes(
        xmin = date, xmax = dplyr::lead(date),
        ymin = -Inf, ymax = Inf,
        fill = status
      ),
      alpha = 0.4
    ) +
    geom_line(
      aes(x = date, y = unemploy),
      color = wso::color.wsoCols("dark blue"), size = 0.75
    ) +
    scale_y_continuous(
      label = comma_format(1)
    ) +
    labs(
      title = "US Unemployment",
      x = "Date",
      y = "People Out of Work"
    ) +
    theme_cs
```

## Ribbon
```{r}

```

## Lines
```{r}

```

# One Variable (Continuous)
## Area
```{r}

```

## Density
```{r}

```

## Dotplot
```{r}

```

## Frequency
```{r}

```

# One Variable (Discrete)
## Bar
### Basic
```{r}
fuelEconomy %>%
  ggplot(
    ## Include in here to it is given to all layers
    ## Make cyl a factor so we can use with bar chart
    aes(x = as.factor(year), y = avgHwy, fill = as.factor(cyl)) 
  ) +
    geom_bar(
      # Put the bars of different groups next to each other instead of stacked
      position = "dodge", stat = "identity"
    ) +
    # Gives us a little breathing room up to so our labels aren't cut off
    geom_blank( 
      aes(y = avgHwy * 1.1)
    ) +
    labs(
      title = "Fuel Economy Over the Years",
      y = "Fuel Economy (mpg)",
      x = "Year"
    ) +
    wso::color.scale_fill_wso(
      name = "Drive Type"
    ) +
    theme_cs
```

Now adjust the column names and add labels to make sure our legend colors and plots fill colors match.
```{r}
fuelEconomy %>%
  ggplot(
    aes(x = as.factor(year), y = avgHwy, fill = as.factor(cyl))
  ) +
    geom_bar(
      position = "dodge", stat = "identity"
    ) +
    geom_text(
      # Specify data for annotations
      aes(label = factor(cyl)), 
      # Space the labels so they aren't stacked
      position = position_dodge(width = 0.9), 
       # Bump the annotation up
      vjust = -1
    ) +
    # Gives us a little breathing room up to so our labels aren't cut off
    geom_blank( 
      aes(y = avgHwy * 1.1)
    ) +
    labs(
      title = "Fuel Economy Over the Years",
      y = "Fuel Economy (mpg)",
      x = "Year"
    ) +
    wso::color.scale_fill_wso(
      name = "Drive Type",
      palette = "dark blue to green",
      interpolate = TRUE,
      labels = c("Four", "Five", "Six", "Eight")
      #labels = c("Eight", "Six", "Five", "Four") ## Watch out this is out of order and you wouldn't know it
    ) +
    theme_cs
```

### Sideways
```{r}
mysleep <- msleep %>%
  arrange(desc(sleep_total)) %>%
  slice(50:70) %>%
  mutate(
    wellRested = if_else(
      sleep_total >= 8, "> 8 Hours", "< 8 Hours"
    )
  )

mysleep %>%
  ggplot() +
    geom_col(
      aes(
        x = fct_reorder(name, sleep_total), 
        y = sleep_total, 
        fill = wellRested
      )
    ) +
    coord_flip() +
    labs(
      title = "How well rested are these animals?",
      y = "Hours of sleep",
      x = "Animal"
    ) +
    scale_y_continuous(
      breaks = seq(0, max(mysleep$sleep_total), 2)
    ) +
    scale_fill_manual(
      name = "Hours of \nsleep per day",
      breaks = c( "> 8 Hours", "< 8 Hours"),
      values = c(
        "> 8 Hours" = unname(wso::color.wsoCols("dark blue")), 
        "< 8 Hours" = unname(wso::color.wsoCols("burnt orange"))
      )
    ) +
    theme_cs
```

# Two Variables (Continuous, Continuous)
## Jitter
```{r}

```

## Point (i.e. Scatter plot)
### Basic
```{r}
miris %>%
  ggplot() +
    geom_point(
      aes(x = Sepal.Width, y = Petal.Width, color = Species),
      size = 3
    ) +
    scale_x_continuous(
      labels = comma_format()
    ) +
    scale_y_continuous(
      labels = comma_format()
    ) +
    labs(
      title = "Pressure vs Wind Speed of Storms",
      x = "Sepal.Width",
      y = "Petal.Width"
    ) +
    wso::color.scale_color_wso() +
    theme_cs
```

### Annotate specific data points
```{r}
selectGroup <- miris %>%
  filter(
    Species == "virginica",
    Sepal.Width > 3750  
  )

selectPoint <- miris %>%
  filter(
    Petal.Width + Sepal.Width == min(Petal.Width + Sepal.Width)
  )

miris %>%
  ggplot(
    aes(x = Petal.Length, y = Sepal.Width)
  ) +
    geom_point(
      aes(color = Species), size = 3
    ) +
    geom_point(data = selectGroup, size = 3, shape = 1) +
    geom_point(data = selectPoint, size = 3, shape = 1) +
    geom_text_repel(data = selectGroup, mapping = aes(label = wsoIndex), point.padding = 1) +
    geom_label_repel(data = selectPoint, mapping = aes(label = wsoIndex), point.padding = 1) +
    scale_x_continuous(
      labels = comma_format()
    ) +
    scale_y_continuous(
      labels = comma_format()
    ) +
    labs(
      title = "Sepal Width by Petal Length",
      x = "Petal.Length (small units)",
      y = "Sepal.Width (small units)"
    ) +
    wso::color.scale_color_wso() +
    theme_cs
```

### Custom Labels for legend
```{r}
storms %>%
  ggplot() +
    geom_point(
      aes(x = wind, y = pressure, color = factor(status))
    ) +
    labs(
      title = "Pressure vs Wind Speed of Storms",
      y = "Pressure (mbar)",
      x = "Wind Speed (mph)"
    ) +
    wso::color.scale_color_wso(
      name = "Drive Type",
      labels = str_to_title(levels(factor(storms$status)))
    ) +
    theme_cs
```

We can set up our factor and levels ahead of time. This is probably a better idea.
```{r}
stormsFactored <- storms %>%
  mutate(
    status = str_to_title(factor(status, levels = c("tropical depression", "tropical storm", "hurricane")))
  ) 

stormsFactored %>%
  ggplot() +
    geom_point(
      aes(x = wind, y = pressure, color = fct_rev(status))
    ) +
    labs(
      title = "Pressure vs Wind Speed of Storms",
      y = "Pressure (mbar)",
      x = "Wind Speed (mph)"
    ) +
    wso::color.scale_color_wso(
      name = "Drive Type",
      labels = levels(fct_rev(stormsFactored$status))
    ) +
    theme_cs
```

## Quantile
```{r}

```

## Rug
```{r}

```

## Smooth
```{r}

```

## Text
```{r}

```

## Label
```{r}

```

# Two Variables (Discrete, Continuous)
## Column
```{r}

```

## Box plot
```{r}

```

## Dot plot
```{r}

```

## Violin
```{r}

```

# Two Variables (Discrete, Discrete)
## Count
```{r}

```

# Miscellaneous
## Time series
```{r}

```

## Removing legend etc.
```{r}

```